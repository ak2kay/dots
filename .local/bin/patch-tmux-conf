#!/bin/bash

if [ -n "$TMUX" ]; then
	TMUX_VERSION=$(tmux -V | awk '{print $2}')

	version_ge() {
		[ "$(printf '%s\n' "$1" "$2" | sort -V | head -n1)" = "$2" ]
	}

	if version_ge "$TMUX_VERSION" "3.4"; then
		echo "# tmux version is 3.4 or newer, not applying terminal-overrides"
	else
		# override the OSC 52 sequence generated by tmux, so tmux could work with mosh shell.
		# see: https://gist.github.com/yudai/95b20e3da66df1b066531997f982b57b
		echo 'set -sa terminal-overrides "vte*:XT:Ms=\\E]52;c;%p2%s\\7,xterm*:XT:Ms=\\E]52;c;%p2%s\\7"'
	fi
else
	echo "# Not inside tmux"
fi
