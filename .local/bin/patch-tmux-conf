#!/bin/bash

if [ -n "$TMUX" ]; then
	TMUX_VERSION=$(tmux -V | awk '{print $2}')

	version_ge() {
		[ "$(printf '%s\n' "$1" "$2" | sort -V | head -n1)" = "$2" ]
	}

	version_lt() {
		[ "$(printf '%s\n' "$1" "$2" | sort -V | head -n1)" = "$1" ] && [ "$1" != "$2" ]
	}

	if version_ge "$TMUX_VERSION" "3.3"; then
		# enable pass-through for image rending
		set -g allow-passthrough on
	fi

	if version_lt "$TMUX_VERSION" "3.4"; then
		# override the OSC 52 sequence generated by tmux, so tmux could work with mosh shell.
		# see: https://gist.github.com/yudai/95b20e3da66df1b066531997f982b57b
		echo 'set -sa terminal-overrides "vte*:XT:Ms=\\E]52;c;%p2%s\\7,xterm*:XT:Ms=\\E]52;c;%p2%s\\7"'
	fi
else
	echo "# Not inside tmux"
fi
